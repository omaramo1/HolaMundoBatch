<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" 
   xmlns:tx="http://www.springframework.org/schema/tx" 
   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
   xmlns:context="http://www.springframework.org/schema/context" 
   xsi:schemaLocation="http://www.springframework.org/schema/beans 
                  http://www.springframework.org/schema/beans/spring-beans.xsd
                  http://www.springframework.org/schema/context
                  http://www.springframework.org/schema/context/spring-context.xsd
                  http://www.springframework.org/schema/tx 
                  http://www.springframework.org/schema/tx/spring-tx.xsd">
   
   <!-- K5VIJ001-01-MX-beans.xml -->
   
   <!-- Set to the required transaction manager -->
   <bean id="transactionManager" class="org.springframework.batch.support.transaction.ResourcelessTransactionManager" />

   <bean class="org.springframework.batch.core.scope.StepScope" />
   
   <bean id="jobLauncher"  class="com.bbva.elara.batch.launcher.SimpleJobLauncherBean">
      <property name="job" ref="K5VIJ001-01-MX" />
      <property name="batchLauncher" ref="batchLauncher" />
      <property name="defaultIncrementer" ref="defaultIncrementer" />       
   </bean>

   <bean id="itemWriter" class="org.springframework.batch.item.file.FlatFileItemWriter" scope="step">
      <property name="resource" value="file:fichtemcomp/datsal/filtrado_capacidades.txt"/>
      <property name="lineAggregator">
         <bean class="org.springframework.batch.item.file.transform.DelimitedLineAggregator">
            <property name="delimiter" value="|"/>
            <property name="fieldExtractor">
               <bean class="org.springframework.batch.item.file.transform.BeanWrapperFieldExtractor">
                  <property name="names" value="block_number_id, customer_id, taxpayer_type, product_id, payment_capacity_amount, segment_approved_line_amount, annual_income_amount, reference_type, commercial_segment_id, customer_legal_personality_id, zone_id, year_number, month_number, customer_age_days_number, origin_type, moratorium_type, cmpgn_cust_prdt_fctr_curr_per, codig_operation_type, account_id, account_card_id, access_channel_id"/>
               </bean>
            </property>
         </bean>
      </property>
   </bean>

   <bean id="itemReader" class="org.springframework.batch.item.file.FlatFileItemReader" scope="step">
      <property name="resource" value="file:fichtemcomp/datsal/ejemplo_capacidades.txt"/>
      <property name="lineMapper">
         <bean class="org.springframework.batch.item.file.mapping.DefaultLineMapper">
            <property name="lineTokenizer">
               <bean class="org.springframework.batch.item.file.transform.DelimitedLineTokenizer">
                  <property name="delimiter" value="|"/>
                  <property name="names" value="block_number_id, customer_id, taxpayer_type, product_id, payment_capacity_amount, segment_approved_line_amount, annual_income_amount, reference_type, commercial_segment_id, customer_legal_personality_id, zone_id, year_number, month_number, customer_age_days_number, origin_type, moratorium_type, cmpgn_cust_prdt_fctr_curr_per, codig_operation_type, account_id, account_card_id, access_channel_id"/>
               </bean>
            </property>
            <property name="fieldSetMapper">
               <bean class="org.springframework.batch.item.file.mapping.BeanWrapperFieldSetMapper">
                  <property name="targetType" value="com.bbva.k5vi.batch.CapacityRecord"/>
               </bean>
            </property>
         </bean>
      </property>
   </bean>

   <bean id="itemProcessor" class="com.bbva.k5vi.batch.PYMEFilterItemProcessor" scope="step"/>
   <bean id="readTasklet" class="com.bbva.k5vi.batch.HolaMundoTasklet" scope="step" />

   <tx:annotation-driven transaction-manager="transactionManager" />
</beans>